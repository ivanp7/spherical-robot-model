(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     13081,        376]
NotebookOptionsPosition[     12674,        360]
NotebookOutlinePosition[     13018,        375]
CellTagsIndexPosition[     12975,        372]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"**", "**"}], "**"}], "**"}], "**"}], "**"}], "**"}],
             "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
    "**"}], "*************)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"**", "\:041e\:043f\:0435\:0440\:0430\:0446\:0438\:0438"}], " ", 
    "\:0441", " ", "\:0432\:0435\:043a\:0442\:043e\:0440\:0430\:043c\:0438", 
    " ", "\:0432", " ", 
    "\:0442\:0440\:0435\:0445\:043c\:0435\:0440\:043d\:043e\:043c", " ", 
    "\:043f\:0440\:043e\:0441\:0442\:0440\:0430\:043d\:0441\:0442\:0432\:0435\
"}], "***)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"**", "**", "**", "**", "**", "**", "**", "**"}], "**"}], 
         "**"}], "**"}], "**"}], "**"}], "**"}], "**"}], 
   "***************)"}]}]], "Input",
 CellChangeTimes->{{3.7072084049134245`*^9, 3.707208439622183*^9}, {
  3.7131692996336164`*^9, 3.7131693471971064`*^9}, {3.7142949433271837`*^9, 
  3.714294962434044*^9}},ExpressionUUID->"4efac88a-3578-4cd7-8540-\
d7c5de6316c1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "\:041d\:0443\:043b\:0435\:0432\:043e\:0439", " ", 
    "\:0432\:0435\:043a\:0442\:043e\:0440"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"nullVector", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0"}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:0421\:0438\:0441\:0442\:0435\:043c\:044b", " ", 
     "\:043a\:043e\:043e\:0440\:0434\:0438\:043d\:0430\:0442"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"cartesian", "[", "vec_", "]"}], ":=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rho", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{"phi", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"theta", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
       RowBox[{"rho", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"Cos", "[", "theta", "]"}], "*", 
           RowBox[{"Cos", "[", "phi", "]"}]}], ",", 
          RowBox[{
           RowBox[{"Cos", "[", "theta", "]"}], "*", 
           RowBox[{"Sin", "[", "phi", "]"}]}], ",", 
          RowBox[{"Sin", "[", "theta", "]"}]}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"spherical", "[", "vec_", "]"}], ":=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rho", "=", 
          RowBox[{"Sqrt", "[", 
           RowBox[{"Total", "[", 
            RowBox[{"vec", "^", "2"}], "]"}], "]"}]}], ",", 
         RowBox[{"x", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "1", "]"}], "]"}]}], ",", 
         RowBox[{"y", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], ",", 
         RowBox[{"z", "=", 
          RowBox[{"vec", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"rho", ",", 
         RowBox[{"ArcTan", "[", 
          RowBox[{"x", ",", "y"}], "]"}], ",", 
         RowBox[{"ArcSin", "[", 
          RowBox[{"z", "/", "rho"}], "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"sphericalAngles", "[", "vec_", "]"}], ":=", 
     RowBox[{
      RowBox[{"spherical", "[", "vec", "]"}], "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;", "3"}], "]"}], "]"}]}], ";"}], "\n", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "\:041e\:043f\:0435\:0440\:0430\:0446\:0438\:0438", " ", "\:0441", " ", 
     "\:043a\:0432\:0430\:0442\:0435\:0440\:043d\:0438\:043e\:043d\:0430\:043c\
\:0438"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quaternion", "[", 
      RowBox[{"sca_", ",", "vec_"}], "]"}], ":=", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"{", "sca", "}"}], ",", "vec"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qScalar", "[", "qu_", "]"}], ":=", 
     RowBox[{"qu", "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"qVector", "[", "qu_", "]"}], ":=", 
     RowBox[{"qu", "[", 
      RowBox[{"[", 
       RowBox[{"2", ";;", "4"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatMultSca", "[", 
      RowBox[{"qu1_", ",", "qu2_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"qScalar", "[", "qu1", "]"}], "*", 
       RowBox[{"qScalar", "[", "qu2", "]"}]}], "-", 
      RowBox[{"Dot", "[", 
       RowBox[{
        RowBox[{"qVector", "[", "qu1", "]"}], ",", 
        RowBox[{"qVector", "[", "qu2", "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatMultVec", "[", 
      RowBox[{"qu1_", ",", "qu2_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"qScalar", "[", "qu1", "]"}], "*", 
       RowBox[{"qVector", "[", "qu2", "]"}]}], "+", 
      RowBox[{
       RowBox[{"qScalar", "[", "qu2", "]"}], "*", 
       RowBox[{"qVector", "[", "qu1", "]"}]}], "+", 
      RowBox[{"Cross", "[", 
       RowBox[{
        RowBox[{"qVector", "[", "qu1", "]"}], ",", 
        RowBox[{"qVector", "[", "qu2", "]"}]}], "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatMult", "[", 
      RowBox[{"qu1_", ",", "qu2_"}], "]"}], ":=", 
     RowBox[{"quaternion", "[", 
      RowBox[{
       RowBox[{"quatMultSca", "[", 
        RowBox[{"qu1", ",", "qu2"}], "]"}], ",", 
       RowBox[{"quatMultVec", "[", 
        RowBox[{"qu1", ",", "qu2"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatConj", "[", "qu_", "]"}], ":=", 
     RowBox[{"quaternion", "[", 
      RowBox[{
       RowBox[{"qScalar", "[", "qu", "]"}], ",", 
       RowBox[{"-", 
        RowBox[{"qVector", "[", "qu", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatNormSq", "[", "qu_", "]"}], ":=", 
     RowBox[{"Total", "[", 
      RowBox[{"qu", "^", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatInv", "[", "qu_", "]"}], ":=", 
     RowBox[{
      RowBox[{"quatConj", "[", "qu", "]"}], "/", 
      RowBox[{"quatNormSq", "[", "qu", "]"}]}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"quatRotate", "[", 
      RowBox[{"qu_", ",", "p_"}], "]"}], ":=", 
     RowBox[{"quatMult", "[", 
      RowBox[{
       RowBox[{"quatMult", "[", 
        RowBox[{"qu", ",", "p"}], "]"}], ",", 
       RowBox[{"quatInv", "[", "qu", "]"}]}], "]"}]}], ";"}], "\n", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:041e\:043f\:0435\:0440\:0430\:0446\:0438\:0438", " ", "\:0441", " ", 
     "\:0432\:0435\:043a\:0442\:043e\:0440\:0430\:043c\:0438"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"vecNormSq", "[", "vec_", "]"}], ":=", 
     RowBox[{"Total", "[", 
      RowBox[{"vec", "^", "2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vecNorm", "[", "vec_", "]"}], ":=", 
     RowBox[{"Sqrt", "[", 
      RowBox[{"Total", "[", 
       RowBox[{"vec", "^", "2"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"distanceSq", "[", 
      RowBox[{"vec1_", ",", "vec2_"}], "]"}], ":=", 
     RowBox[{"vecNormSq", "[", 
      RowBox[{"vec1", "-", "vec2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"distance", "[", 
      RowBox[{"vec1_", ",", "vec2_"}], "]"}], ":=", 
     RowBox[{"vecNorm", "[", 
      RowBox[{"vec1", "-", "vec2"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vecNormalize", "[", "vec_", "]"}], ":=", 
     RowBox[{"vec", "/", 
      RowBox[{"vecNorm", "[", "vec", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:041a\:043e\:0441\:0438\:043d\:0443\:0441", " ", 
     "\:0443\:0433\:043b\:0430", " ", "\:0438", " ", 
     "\:0443\:0433\:043e\:043b", " ", "\:043c\:0435\:0436\:0434\:0443", " ", 
     "\:0432\:0435\:043a\:0442\:043e\:0440\:0430\:043c\:0438"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vecAngleCos", "[", 
      RowBox[{"vec1_", ",", "vec2_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"Dot", "[", 
       RowBox[{"vec1", ",", "vec2"}], "]"}], "/", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"vecNorm", "[", "vec1", "]"}], "*", 
        RowBox[{"vecNorm", "[", "vec2", "]"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vecAngle", "[", 
      RowBox[{"vec1_", ",", "vec2_"}], "]"}], ":=", 
     RowBox[{"ArcCos", "[", 
      RowBox[{"vecAngleCos", "[", 
       RowBox[{"vec1", ",", "vec2"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"vecToQuat", "[", "vec_", "]"}], ":=", 
     RowBox[{"quaternion", "[", 
      RowBox[{"0", ",", "vec"}], "]"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:041f\:043e\:0432\:043e\:0440\:043e\:0442", " ", 
     "\:0432\:0435\:043a\:0442\:043e\:0440\:0430", " ", "\:0441", " ", 
     "\:043f\:043e\:043c\:043e\:0449\:044c\:044e", " ", 
     "\:043a\:0432\:0430\:0442\:0435\:0440\:043d\:0438\:043e\:043d\:0430"}], 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rotateByQ", "[", 
      RowBox[{"vec_", ",", "qu_"}], "]"}], ":=", 
     RowBox[{"qVector", "[", 
      RowBox[{"quatRotate", "[", 
       RowBox[{"qu", ",", 
        RowBox[{"vecToQuat", "[", "vec", "]"}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "\:041a\:0432\:0430\:0442\:0435\:0440\:043d\:0438\:043e\:043d", " ", 
     "\:0432\:0440\:0430\:0449\:0435\:043d\:0438\:044f"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"rotQuat", "[", 
      RowBox[{"angle_", ",", "axis_"}], "]"}], ":=", 
     RowBox[{"quaternion", "[", 
      RowBox[{
       RowBox[{"Cos", "[", 
        RowBox[{"angle", "/", "2"}], "]"}], ",", 
       RowBox[{
        RowBox[{"Sin", "[", 
         RowBox[{"angle", "/", "2"}], "]"}], "*", 
        RowBox[{"vecNormalize", "[", "axis", "]"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "\:043d\:0443\:043b\:0435\:0432\:043e\:0435", " ", 
     "\:0432\:0440\:0430\:0449\:0435\:043d\:0438\:0435"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"idQuat", "=", 
     RowBox[{"quaternion", "[", 
      RowBox[{"1", ",", "nullVector"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7074769980863237`*^9, 3.707477134110196*^9}, {
   3.7074805932037983`*^9, 3.707480615279552*^9}, {3.707480657772353*^9, 
   3.7074806896786823`*^9}, {3.707481019706455*^9, 3.70748105594634*^9}, {
   3.7074811303483534`*^9, 3.707481145100829*^9}, {3.7074832329888315`*^9, 
   3.707483261548976*^9}, {3.7074833576288605`*^9, 3.7074833893334455`*^9}, {
   3.7074836284552593`*^9, 3.7074836583717227`*^9}, 3.7075730841267505`*^9, {
   3.707682634844781*^9, 3.707682655350935*^9}, {3.707684092486568*^9, 
   3.707684109854828*^9}, {3.712400575771904*^9, 3.712400582369773*^9}, {
   3.7131668465408187`*^9, 
   3.713166887129672*^9}},ExpressionUUID->"f7bc45cf-585c-44b8-a178-\
9ad945df6809"]
},
WindowSize->{879, 977},
WindowMargins->{{Automatic, 212}, {-6, Automatic}},
FrontEndVersion->"11.1 for Microsoft Windows (64-bit) (March 13, 2017)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 1437, 42, 69, "Input", "ExpressionUUID" -> \
"4efac88a-3578-4cd7-8540-d7c5de6316c1"],
Cell[1998, 64, 10672, 294, 905, "Input", "ExpressionUUID" -> \
"f7bc45cf-585c-44b8-a178-9ad945df6809"]
}
]
*)

(* End of internal cache information *)

